{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('css/forumFront.css') }}?v=3">
{% endblock %}

{% block body %}
	<div
		class="patient-app forum-page">

		{# EXACT same header #}
		{% include 'FrontOffice/patient/_header.html.twig' %}

		<main class="patient-main forum-main">
			<div
				class="container">

				<!-- HERO -->
				<section class="forum-hero">
					<div class="forum-hero__inner">
						<div class="forum-hero__text">
							<h1 class="forum-hero__title">Forum</h1>
							<p class="forum-hero__subtitle">
								Partagez des infos, posez des questions et Ã©changez avec la communautÃ©.
							</p>
						</div>

						<div class="forum-hero__actions">
							{% if app.user %}
								<a href="{{ path('forum_post_new') }}" class="btn btn-primary btn-forum">
									<i class="bi bi-plus-circle"></i>
									Nouvelle publication
								</a>
							{% else %}
								<a href="{{ path('app_login') }}" class="btn btn-outline-primary btn-forum">
									<i class="bi bi-box-arrow-in-right"></i>
									Se connecter
								</a>
							{% endif %}
						</div>
					</div>
				</section>

				<!-- FEED -->
				<div class="forum-layout">
					<div class="forum-feed">

						{% for post in posts %}
							<article
								class="post-card">

								<!-- TOP -->
								<header class="post-top">
									<div class="post-user">
										<div class="post-avatar">
											{% if post.utilisateur %}
												{{ post.utilisateur.prenom|slice(0,1)|upper }}
											{% else %}
												U
											{% endif %}
										</div>

										<div class="post-meta">
											<div class="post-name">
												{% if post.utilisateur %}
													{{ post.utilisateur.prenom }}
													{{ post.utilisateur.nom }}
												{% else %}
													Utilisateur
												{% endif %}
											</div>

											<div class="post-time">
												<i class="bi bi-clock"></i>
												{{ post.dateDeCreation ? post.dateDeCreation|date('d/m/Y H:i') : 'PubliÃ© rÃ©cemment' }}
											</div>
										</div>
									</div>

									{% if post.status %}
										<span class="status-pill {{ post.status == 'ACTIVE' ? 'is-active' : 'is-inactive' }}">
											<span class="dot"></span>
											{{ post.status }}
										</span>
									{% endif %}
								</header>

								<!-- BODY -->
								<div class="post-body">
									<h5 class="post-title">{{ post.title }}</h5>
									<p class="post-text">{{ post.content }}</p>

									{% if post.imageName %}
										<div class="post-media">
											<img src="{{ asset('uploads/posts/' ~ post.imageName) }}" alt="Image de la publication" loading="lazy">
										</div>
										{% else %}
									{# optional placeholder, you can remove this block if you want #}
										{# <div class="post-media post-media--empty">
										      <i class="bi bi-image"></i>
										    </div> #}
									{% endif %}

								</div>

								<!-- ACTIONS -->
								<footer class="post-actions">
									<button class="action-btn" type="button" data-bs-toggle="collapse" data-bs-target="#comments-{{ post.id }}" aria-expanded="false" aria-controls="comments-{{ post.id }}">
										<i class="bi bi-chat-dots"></i>
										Commentaires
										<span class="count">{{ post.commentaires|length }}</span>
									</button>

									{% if app.user %}
										<a class="action-btn" href="{{ path('forum_comment_new', { postId: post.id }) }}">
											<i class="bi bi-chat-left-text"></i>
											Ajouter
										</a>
									{% else %}
										<a class="action-btn" href="{{ path('app_login') }}">
											<i class="bi bi-box-arrow-in-right"></i>
											Se connecter
										</a>
									{% endif %}
								</footer>

								<!-- COMMENTS -->
								<div class="collapse" id="comments-{{ post.id }}">
									<div class="comments-wrap">

										{% if post.commentaires|length > 0 %}
											{% for c in post.commentaires %}
												<div class="comment-item">

													<div class="comment-avatar">
														{% if c.utilisateur %}
															{{ c.utilisateur.prenom|slice(0,1)|upper }}
														{% else %}
															U
														{% endif %}
													</div>

													<div class="comment-bubble">
														<div class="comment-top">
															<div class="comment-left">
																<span class="comment-name">
																	{% if c.utilisateur %}
																		{{ c.utilisateur.prenom }}
																		{{ c.utilisateur.nom }}
																	{% else %}
																		Utilisateur
																	{% endif %}
																</span>
																<span class="comment-time">{{ c.date|date('d/m/Y H:i') }}</span>
															</div>

															{% if c.status %}
																<span class="mini-pill {{ c.status == 'ACTIVE' ? 'is-active' : 'is-inactive' }}">
																	{{ c.status }}
																</span>
															{% endif %}
														</div>

														<div class="comment-text">{{ c.content }}</div>
													</div>
												</div>
											{% endfor %}
										{% else %}
											<div class="empty-state">Aucun commentaire pour le moment ðŸ™‚</div>
										{% endif %}

									</div>
								</div>

							</article>
						{% else %}
							<div class="empty-state">Aucune publication pour le moment ðŸ™‚</div>
						{% endfor %}

					</div>
				</div>

			</div>
		</main>
	</div>
{% endblock %}
