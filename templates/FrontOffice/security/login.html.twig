{% extends 'FrontOffice/base.html.twig' %}

{% block title %}Connexion{% endblock %}

{% block body %}
<style>
  :root{
    --blue:#1e6fb9;
    --blue2:#2a7fd1;
    --ink:#1f2a37;
    --muted:#6b7280;
    --ice:#f7fbff;
    --stroke:#d7e7fb;
    --danger:#dc2626;
  }

  /* Page */
  .login-page{
    min-height: 92vh;
    display:grid;
    place-items:center;
    background:
      radial-gradient(900px 420px at 18% 12%, rgba(30,111,185,.16), transparent 58%),
      radial-gradient(900px 420px at 88% 32%, rgba(90,169,230,.18), transparent 58%),
      linear-gradient(180deg, #f9fcff 0%, #eef6ff 100%);
    padding: 24px 0;
  }

  /* Card */
  .login-shell{
    max-width: 1040px;
  }
  .login-card{
    border:0;
    border-radius: 26px;
    overflow:hidden;
    background:#fff;
    box-shadow:
      0 24px 70px rgba(30, 41, 59, .16),
      0 6px 18px rgba(30, 41, 59, .08);
  }

  /* Aside */
  .login-aside{
    position:relative;
    color:#fff;
    background: linear-gradient(135deg, #1e6fb9, #5aa9e6);
    padding: 46px 44px;
    overflow:hidden;
  }
  .login-aside::before{
    content:"";
    position:absolute;
    inset:0;
    background:
      radial-gradient(500px 220px at 25% 20%, rgba(255,255,255,.24), transparent 55%),
      radial-gradient(520px 240px at 80% 55%, rgba(255,255,255,.18), transparent 55%),
      linear-gradient(120deg, rgba(255,255,255,.12), transparent 40%);
    opacity:.85;
    pointer-events:none;
  }

  .brand-badge{
    position:relative;
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding: 7px 14px;
    border-radius: 999px;
    background: rgba(255,255,255,.18);
    border: 1px solid rgba(255,255,255,.30);
    backdrop-filter: blur(10px);
    font-weight: 900;
    letter-spacing:.2px;
    font-size:.82rem;
  }
  .brand-badge i{ opacity:.95; }

  .aside-title{
    position:relative;
    margin-top: 14px;
    font-weight: 950;
    font-size: 2.15rem;
    line-height: 1.05;
    letter-spacing: -.4px;
  }
  .aside-sub{
    position:relative;
    margin-top: 10px;
    opacity:.92;
    font-weight: 600;
    max-width: 340px;
  }

  .aside-tip{
    position:relative;
    margin-top: 18px;
    padding: 12px 14px;
    border-radius: 16px;
    background: rgba(255,255,255,.14);
    border: 1px solid rgba(255,255,255,.22);
    backdrop-filter: blur(10px);
    font-weight: 700;
  }
  .aside-tip small{ display:block; opacity:.80; font-weight:600; margin-top:4px; }

  /* Form side */
  .login-formwrap{
    padding: 46px 44px;
  }
  .form-title{
    color: var(--ink);
    font-weight: 950;
    letter-spacing: -.2px;
    margin-bottom: 6px;
  }
  .form-subtitle{
    color: var(--muted);
    margin-bottom: 22px;
    font-weight: 600;
  }

  /* Inputs with icon */
  .field{
    margin-bottom: 14px;
  }
  .field-label{
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-size: .78rem;
    text-transform: uppercase;
    letter-spacing: .08em;
    color: var(--muted);
    font-weight: 900;
    margin-bottom: 6px;
  }
  .control{
    position:relative;
  }
  .control i.leading{
    position:absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: rgba(30,111,185,.65);
    pointer-events:none;
  }
  .input{
    width:100%;
    border-radius: 16px;
    padding: 13px 14px 13px 44px;
    border: 1px solid var(--stroke);
    background: var(--ice);
    font-weight: 650;
    outline:none;
    transition: border-color .15s ease, box-shadow .15s ease, transform .12s ease;
  }
  .input:focus{
    border-color: rgba(30,111,185,.85);
    box-shadow: 0 0 0 .22rem rgba(30,111,185,.16);
  }

  .help{
    margin-top: 6px;
    color: var(--muted);
    font-size: .86rem;
    font-weight: 600;
  }

  /* Password toggle */
  .toggle{
    position:absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    border: 0;
    border-radius: 14px;
    padding: 8px 10px;
    background: rgba(30,111,185,.10);
    border: 1px solid rgba(30,111,185,.14);
    color:#1e4f80;
    cursor:pointer;
    transition: transform .12s ease, background .12s ease;
  }
  .toggle:hover{
    background: rgba(30,111,185,.14);
    transform: translateY(-50%) scale(1.03);
  }

  /* Button */
  .btn-login{
    margin-top: 12px;
    width:100%;
    border:0;
    border-radius: 16px;
    padding: 13px 14px;
    font-weight: 950;
    color:#fff;
    background: linear-gradient(135deg, var(--blue), var(--blue2));
    box-shadow: 0 14px 28px rgba(30,111,185,.20);
    transition: transform .14s ease, box-shadow .14s ease;
  }
  .btn-login:hover{
    transform: translateY(-1px);
    box-shadow: 0 18px 36px rgba(30,111,185,.26);
  }

  .links{
    margin-top: 16px;
    display:flex;
    justify-content:space-between;
    gap: 12px;
    flex-wrap:wrap;
  }
  .links a{
    color: var(--blue);
    text-decoration:none;
    font-weight: 800;
  }
  .links a:hover{ text-decoration:underline; }

  /* Error */
  .alert-auth{
    border-radius: 16px;
    border: 1px solid rgba(220,38,38,.25);
    background: rgba(220,38,38,.08);
    color: #991b1b;
    padding: 12px 14px;
    font-weight: 700;
    margin-bottom: 14px;
  }

  /* Old man ‚Äî keep same (minimal changes, just spacing) */
  .oldman-wrap{ position:relative; margin-top: 18px; }
  .oldman{
    width: 220px;
    height: 220px;
    position: relative;
    filter: drop-shadow(0 18px 35px rgba(0,0,0,.18));
  }
  .oldman .head{
    position:absolute; inset:0; margin:auto;
    width: 160px; height: 160px; border-radius: 50%;
    background: rgba(255,255,255,.88);
    box-shadow: inset 0 -12px 0 rgba(0,0,0,.06);
  }
  .oldman .hair{
    position:absolute; top: 38px; left: 50%; transform: translateX(-50%);
    width: 142px; height: 66px; border-radius: 999px 999px 40px 40px;
    background: rgba(255,255,255,.72);
    border: 1px solid rgba(255,255,255,.35);
  }
  .oldman .hair::after{
    content:""; position:absolute; left:50%; top: 22px; transform:translateX(-50%);
    width: 88px; height: 26px; border-radius:999px;
    background: rgba(255,255,255,.45);
  }
  .oldman .glasses{
    position:absolute; top: 90px; left:50%; transform:translateX(-50%);
    width: 136px; height: 44px; display:flex; justify-content:space-between; z-index:3;
  }
  .glass{
    width: 58px; height: 40px; border-radius: 16px;
    border: 2px solid rgba(30,111,185,.35);
    background: rgba(255,255,255,.28);
    backdrop-filter: blur(8px);
    position: relative;
    overflow:hidden;
  }
  .bridge{
    position:absolute; left:50%; top: 18px; transform:translateX(-50%);
    width: 18px; height: 6px; border-radius:999px; background: rgba(30,111,185,.35);
  }
  .eye{
    position:absolute; top: 9px; left: 18px;
    width: 18px; height: 18px; border-radius:50%;
    background: rgba(31,42,55,.92);
    transition: transform .12s ease;
  }
  .hands{
    position:absolute; top: 98px; left:50%; transform:translateX(-50%);
    width: 200px; height: 90px; z-index:5; pointer-events:none;
  }
  .hand{
    width: 84px; height: 84px; border-radius: 22px;
    background: rgba(255,255,255,.88);
    box-shadow: inset 0 -10px 0 rgba(0,0,0,.06);
    position:absolute; top:0;
    transition: transform .32s cubic-bezier(.2,.9,.2,1);
  }
  .hand.left { left: 0; transform: translate(0, 28px) rotate(-8deg); }
  .hand.right{ right:0; transform: translate(0, 28px) rotate(8deg); }

  /* show password => hide eyes (hands up) */
  .oldman.is-hiding .hand.left  { transform: translate(40px, -24px) rotate(-18deg); }
  .oldman.is-hiding .hand.right { transform: translate(-40px, -24px) rotate(18deg); }

  /* hide password => hands down */
  .oldman.is-showing .hand.left  { transform: translate(0, 32px) rotate(-8deg); }
  .oldman.is-showing .hand.right { transform: translate(0, 32px) rotate(8deg); }

  .oldman .moustache{
    position:absolute; top: 132px; left:50%; transform:translateX(-50%);
    width: 60px; height: 18px; border-radius:999px;
    background: rgba(31,42,55,.10);
  }

  /* responsive */
  @media (max-width: 991px){
    .login-aside, .login-formwrap{ padding: 32px 22px; }
    .aside-title{ font-size: 1.9rem; }
  }
</style>

<div class="login-page">
  <div class="container login-shell">
    <div class="row justify-content-center">
      <div class="col-12">
        <div class="card login-card">
          <div class="row g-0">

            <div class="col-lg-6 login-aside d-flex flex-column justify-content-center">
              <div class="brand-badge">
                <i class="fa-solid fa-shield-heart"></i>
                Elder HealthCare
              </div>

              <div class="aside-title">Bienvenue üëã</div>
              <div class="aside-sub">Connecte-toi en toute s√©curit√© pour acc√©der √† ton espace.</div>

              <div class="oldman-wrap">
                <div id="oldman" class="oldman is-showing" aria-hidden="true">
                  <div class="head"></div>
                  <div class="hair"></div>

                  <div class="glasses">
                    <div class="glass">
                      <div class="eye"></div>
                    </div>
                    <div class="glass">
                      <div class="eye"></div>
                    </div>
                    <div class="bridge"></div>
                  </div>

                  <div class="moustache"></div>

                  <div class="hands">
                    <div class="hand left"></div>
                    <div class="hand right"></div>
                  </div>
                </div>
              </div>

              <div class="aside-tip">
                <i class="fa-solid fa-user-shield me-2"></i>
                Quand tu <b>affiches</b> le mot de passe, il se cache les yeux ü§≠
                <small>Astuce: utilise l‚Äôic√¥ne üëÅ pour basculer.</small>
              </div>
            </div>

            <div class="col-lg-6 login-formwrap">
              <h2 class="form-title">Connexion</h2>
              <div class="form-subtitle">Ravi de te revoir. Entrez vos informations.</div>

              {% if error %}
                <div class="alert-auth">
                  <i class="fa-solid fa-triangle-exclamation me-2"></i>
                  {{ error.messageKey|trans(error.messageData, 'security') }}
                </div>
              {% endif %}

              <form method="post" action="{{ path('app_login') }}" novalidate>
                <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">

                <div class="field">
                  <div class="field-label">Adresse Email</div>
                  <div class="control">
                    <i class="fa-solid fa-envelope leading"></i>
                    <input
                      type="email"
                      name="_username"
                      id="inputEmail"
                      class="input"
                      value="{{ last_username }}"
                      required
                      autofocus
                      autocomplete="email"
                      placeholder="ex: nom.prenom@email.com"
                    >
                  </div>
                </div>

                <div class="field">
                  <div class="field-label">Mot de passe</div>
                  <div class="control">
                    <i class="fa-solid fa-lock leading"></i>
                    <input
                      type="password"
                      name="_password"
                      id="inputPassword"
                      class="input"
                      required
                      minlength="8"
                      autocomplete="current-password"
                      placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                      style="padding-right: 56px;"
                    >
                    <button type="button" id="togglePassword" class="toggle" aria-label="Afficher le mot de passe">
                      <i class="fa-solid fa-eye"></i>
                    </button>
                  </div>
                  <div class="help">Minimum 8 caract√®res.</div>
                </div>

                <button class="btn-login" type="submit">
                  <i class="fa-solid fa-right-to-bracket me-2"></i>
                  Se connecter
                </button>

                <div class="links">
                  <a href="{{ path('app_register') }}"><i class="fa-solid fa-user-plus me-1"></i>Cr√©er un compte</a>
                  <a href="{{ path('app_forgot_password_request') }}"><i class="fa-solid fa-key me-1"></i>Mot de passe oubli√© ?</a>
                </div>
              </form>

            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const pwd = document.getElementById('inputPassword');
  const toggle = document.getElementById('togglePassword');
  const oldman = document.getElementById('oldman');
  if (!pwd || !toggle || !oldman) return;

  const eyes = oldman.querySelectorAll('.eye');

  // eyes follow mouse (subtle)
  let targetX = 0, targetY = 0, curX = 0, curY = 0;
  function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

  function animate(){
    curX += (targetX - curX) * 0.18;
    curY += (targetY - curY) * 0.18;
    eyes.forEach(e => e.style.transform = `translate(${curX}px, ${curY}px)`);
    requestAnimationFrame(animate);
  }
  animate();

  document.addEventListener('mousemove', (e) => {
    const rect = oldman.getBoundingClientRect();
    const cx = rect.left + rect.width / 2;
    const cy = rect.top + rect.height / 2;
    targetX = clamp((e.clientX - cx) / 60, -7, 7);
    targetY = clamp((e.clientY - cy) / 80, -4, 4);
  });

  function applyState(){
    // show password => hide eyes, hide password => show eyes
    const isShowingPassword = (pwd.type === 'text');
    oldman.classList.remove('is-hiding','is-showing');
    oldman.classList.add(isShowingPassword ? 'is-hiding' : 'is-showing');
  }

  applyState();

  toggle.addEventListener('click', function () {
    const isHidden = pwd.type === 'password';
    pwd.type = isHidden ? 'text' : 'password';

    const icon = toggle.querySelector('i');
    if (icon) {
      icon.classList.toggle('fa-eye');
      icon.classList.toggle('fa-eye-slash');
    }
    toggle.setAttribute('aria-label', isHidden ? 'Masquer le mot de passe' : 'Afficher le mot de passe');
    applyState();
  });
});
</script>
{% endblock %}
