{% block stylesheets %}
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="{{ asset('css/infermier.css') }}">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
{% endblock %}

{% block body %}
	<div class="nurse-app">
		{% include 'FrontOffice/infermier/_header.html.twig' %}
		<main class="nurse-main consultation-page">
			<section class="consultation-header">
				<div class="card-head">
					<div>
						<h2 class="consultation-title">Demandes de rendez-vous</h2>
						<p class="consultation-subtitle">Acceptez ou refusez les demandes de vos patients.</p>
					</div>
				</div>
			</section>

			{% for message in app.flashes('success') %}
				<div class="alert alert-success alert-dismissible fade show mt-3" role="alert">
					{{ message }}
					<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
				</div>
			{% endfor %}

			<section class="grid consult-grid">
				{% for rdv in rendezVousList %}
					{% set status = rdv.etat ? rdv.etat|lower : '' %}
					{% set status_label = status == 'en_attente' ? 'En attente'
						: (status == 'planifie' or status == 'planifiee' ? 'Planifie'
						: (status == 'en_cours' ? 'En cours'
						: (status == 'termine' or status == 'terminee' ? 'Termine'
						: (status == 'annulee' ? 'Annulee'
						: (status == 'refusee' ? 'Refusee' : (rdv.etat ?? '')))))) %}
					<div class="card consultation-card" data-status="{{ status }}">
						<div class="consultation-accent"></div>
						<div class="card-head">
							<h2><i class="bi bi-calendar2-week"></i>Rendez-vous</h2>
							<span class="badge-soft">{{ status_label }}</span>
						</div>
						<div class="consultation-meta">
							<span class="consultation-chip chip-green"><i class="bi bi-person-circle"></i> {{ rdv.patient ? (rdv.patient.prenom ~ ' ' ~ rdv.patient.nom) : '-' }}</span>
							<span class="consultation-chip"><i class="bi bi-bookmark-heart"></i> {{ rdv.typeRendezVous ? rdv.typeRendezVous.type : '-' }}</span>
						</div>
						<div class="consultation-meta">
							<span class="consultation-chip chip-amber"><i class="bi bi-calendar-event"></i> {{ rdv.date ? rdv.date|date('d/m/Y') : '-' }}</span>
							<span class="consultation-chip chip-amber"><i class="bi bi-clock"></i> {{ rdv.heure ? rdv.heure|date('H:i') : '-' }}</span>
							{% if rdv.lieu %}
								<span class="consultation-chip chip-pink"><i class="bi bi-geo-alt"></i> {{ rdv.lieu }}</span>
							{% endif %}
						</div>
						<div class="consultation-grid">
							<div class="consultation-row">
								<div class="consultation-label">Personnel medical</div>
								<div class="value">
									{% if rdv.personnelMedical %}
										{{ rdv.personnelMedical.prenom }} {{ rdv.personnelMedical.nom }}
									{% else %}
										-
									{% endif %}
								</div>
							</div>
							<div class="consultation-row">
								<div class="consultation-label">Patient</div>
								<div class="value">
									{% if rdv.patient %}
										{{ rdv.patient.prenom }} {{ rdv.patient.nom }}
									{% else %}
										-
									{% endif %}
								</div>
							</div>
						</div>
						<div class="consultation-actions">
							{% if rdv.etat == 'EN_ATTENTE' %}
								<a class="btn-sm primary" href="{{ path('front_infermier_rendezvous_accept', {'id': rdv.id}) }}">Accepter</a>
								<a class="btn-sm danger" href="{{ path('front_infermier_rendezvous_refuse', {'id': rdv.id}) }}">Refuser</a>
							{% endif %}
						</div>
					</div>
				{% else %}
					<div class="card consultation-card">
						<div class="consultation-accent"></div>
						<p class="muted">Aucun rendez-vous pour le moment.</p>
					</div>
				{% endfor %}
			</section>
		</main>
	</div>
{% endblock %}

{% block javascripts %}
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
