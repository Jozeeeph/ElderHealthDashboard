{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('css/infermier.css') }}">
	<style>
		.prebilan-page {
			background:
				radial-gradient(circle at 10% 12%, rgba(59, 130, 246, 0.14), transparent 38%),
				radial-gradient(circle at 86% 18%, rgba(16, 185, 129, 0.12), transparent 40%),
				linear-gradient(180deg, #f7fbff 0%, #f4fbf7 58%, #ffffff 100%);
			border: 1px solid #e4edf2;
			border-radius: 20px;
			padding: 18px;
		}

		.prebilan-hero {
			display: flex;
			justify-content: space-between;
			align-items: center;
			gap: 14px;
			flex-wrap: wrap;
			background: #ffffff;
			border: 1px solid #e2e8f0;
			border-radius: 18px;
			padding: 16px 18px;
			box-shadow: 0 12px 26px rgba(15, 23, 42, 0.07);
		}

		.prebilan-title {
			margin: 0;
			font-size: 1.4rem;
			font-weight: 800;
			color: #0f172a;
		}

		.prebilan-subtitle {
			margin: 6px 0 0;
			color: #64748b;
			font-weight: 600;
		}

		.prebilan-grid {
			margin-top: 14px;
			display: grid;
			grid-template-columns: 300px 1fr;
			gap: 14px;
		}

		.prebilan-side,
		.prebilan-content {
			background: #ffffff;
			border: 1px solid #e2e8f0;
			border-radius: 16px;
			box-shadow: 0 10px 24px rgba(15, 23, 42, 0.06);
		}

		.prebilan-side {
			padding: 14px;
		}

		.prebilan-card-title {
			margin: 0 0 10px;
			font-size: .95rem;
			text-transform: uppercase;
			letter-spacing: .05em;
			color: #64748b;
			font-weight: 800;
		}

		.prebilan-stat {
			border: 1px solid #e7edf2;
			border-radius: 12px;
			padding: 10px 12px;
			background: #f8fafc;
			margin-bottom: 8px;
		}

		.prebilan-stat .k {
			color: #64748b;
			font-size: .8rem;
			font-weight: 700;
		}

		.prebilan-stat .v {
			color: #0f172a;
			font-size: 1rem;
			font-weight: 800;
		}

		.prebilan-content {
			padding: 14px;
		}

		.prebilan-output {
			margin: 0;
			white-space: pre-wrap;
			background: #f8fafc;
			border: 1px solid #e2e8f0;
			border-radius: 12px;
			padding: 14px;
			color: #0f172a;
			font-family: inherit;
			line-height: 1.55;
			min-height: 300px;
		}

		.prebilan-source {
			display: inline-flex;
			align-items: center;
			gap: 8px;
			padding: 7px 11px;
			border-radius: 999px;
			font-weight: 700;
			font-size: .85rem;
			border: 1px solid transparent;
		}

		.prebilan-source.ok {
			background: #ecfdf5;
			color: #065f46;
			border-color: #a7f3d0;
		}

		.prebilan-source.fallback {
			background: #fff7ed;
			color: #9a3412;
			border-color: #fed7aa;
		}

		@media (max-width: 980px) {
			.prebilan-grid {
				grid-template-columns: 1fr;
			}
		}
	</style>
{% endblock %}

{% block body %}
	<div class="nurse-app">
		{% include 'FrontOffice/infermier/_header.html.twig' %}

		<main class="nurse-main">
			<div class="prebilan-page">
				<section class="prebilan-hero">
					<div>
						<h2 class="prebilan-title">Pre-bilan analytique</h2>
						<p class="prebilan-subtitle">Synthese clinique assistee pour le suivi patient.</p>
					</div>
					<a class="btn btn-outline-secondary" href="{{ path('front_infermier_consultation_index') }}">Retour</a>
				</section>

				<section class="prebilan-grid">
					<aside class="prebilan-side">
						<h3 class="prebilan-card-title">Informations</h3>
						<div class="prebilan-stat">
							<div class="k">Patient</div>
							<div class="v">{{ patient.prenom }} {{ patient.nom }}</div>
						</div>
						<div class="prebilan-stat">
							<div class="k">Consultations analysees</div>
							<div class="v">{{ consultations|length }}</div>
						</div>

						{% if preBilanSource == 'openai' %}
							<span class="prebilan-source ok">Generation IA active</span>
						{% else %}
							<span class="prebilan-source fallback">Mode fallback analytique</span>
						{% endif %}
					</aside>

					<div class="prebilan-content">
						{% if preBilanSource != 'openai' and preBilanDebugReason %}
							<div class="alert alert-info mb-2 py-2">
								<strong>Debug IA :</strong> {{ preBilanDebugReason }}
							</div>
						{% endif %}
						<pre class="prebilan-output">{{ preBilan }}</pre>
					</div>
				</section>
			</div>
		</main>
	</div>
{% endblock %}
