{% block title %}
{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

	<link rel="stylesheet" href="{{ asset('css/patient.css') }}?v=2">
	<link rel="stylesheet" href="{{ asset('css/eventsFront.css') }}?v=4">
{% endblock %}


{% block body %}
	<div
		class="patient-app">

		{# ✅ TOPBAR patient #}
		{% include 'FrontOffice/patient/_header.html.twig' %}

		<main class="patient-main">

			<div class="container" style="max-width: 1100px;">

				{% set typeColor = event.type and event.type.couleur ? event.type.couleur : '#6c757d' %}

				{# ✅ Flash messages #}
				{% for label, messages in app.flashes %}
					{% for msg in messages %}
						<div class="alert alert-{{ label }} mb-3">{{ msg }}</div>
					{% endfor %}
				{% endfor %}

				<div class="ev-header mb-4">
					<div class="d-flex align-items-center justify-content-between gap-3 flex-wrap">
						<div>
							<h1 class="ev-title">{{ event.titre }}</h1>
							<p class="ev-subtitle">Toutes les informations de l’événement.</p>
						</div>

					
					</div>
				</div>

				<div class="ev-card mb-4" style="--typeColor: {{ typeColor }};">

					<div class="ev-card__top">
						<div class="ev-avatar" style="background: {{ typeColor }}22; color: {{ typeColor }};">
							{{ event.titre|default('E')|slice(0,1)|upper }}
						</div>

						<div class="ev-meta">
							<div class="ev-name">{{ event.titre }}</div>

							<div class="ev-time">
								<i class="bi bi-calendar-event"></i>
								{{ event.dateDebut ? event.dateDebut|date('d/m/Y H:i') : 'Date non définie' }}
								{% if event.dateFin %}
									<span class="mx-1">→</span>
									{{ event.dateFin|date('d/m/Y H:i') }}
								{% endif %}
							</div>

							{% if event.lieu %}
								<div class="ev-place">
									<i class="bi bi-geo-alt"></i>
									{{ event.lieu }}
								</div>
							{% endif %}
						</div>

						{% if event.type %}
							<span class="ev-badge" style="background: {{ typeColor }};">
								<i class="bi bi-tag"></i>
								{{ event.type.libelle }}
							</span>
						{% else %}
							<span class="ev-badge ev-badge--muted">
								<i class="bi bi-tag"></i>
								Sans type
							</span>
						{% endif %}
					</div>

					<div class="ev-card__body">

						{% if event.image %}
							<div class="ev-image ev-image--big">
								<img src="{{ asset('uploads/events/' ~ event.image) }}" alt="Image de l'événement" loading="lazy">
							</div>
						{% endif %}

						<div class="ev-infos ev-infos--big">
							{% if event.capaciteMax %}
								<span class="ev-chip">
									<i class="bi bi-people"></i>
									Capacité :
									{{ participantsCount }}/{{ event.capaciteMax }}
								</span>
							{% else %}
								<span class="ev-chip">
									<i class="bi bi-people"></i>
									Participants :
									{{ participantsCount }}
								</span>
							{% endif %}

							<span class="ev-chip">
								<i class="bi bi-megaphone"></i>
								Statut :
								{{ event.statut|default('BROUILLON') }}
							</span>

							{% if isFull %}
								<span class="ev-chip" style="border-color:#dc3545;color:#dc3545;">
									<i class="bi bi-x-circle"></i>
									Complet
								</span>
							{% endif %}

							{% if isParticipating %}
								<span class="ev-chip" style="border-color:#198754;color:#198754;">
									<i class="bi bi-check-circle"></i>
									Vous participez
								</span>
							{% endif %}
						</div>

						<div class="ev-section">
							<h3 class="ev-section__title">Description</h3>
							<div class="ev-desc">
								{{ event.description|default('') }}
							</div>
						</div>

						<div class="ev-btnrow">
							{% if app.user is null %}
								<a class="ehc-btn ehc-btn-primary" href="{{ path('app_login') }}">
									<i class="bi bi-box-arrow-in-right"></i>
									Se connecter pour participer
								</a>
							{% else %}
								<form method="post" action="{{ path('front_events_participer', {id: event.id}) }}">
									<input type="hidden" name="_token" value="{{ csrf_token('front_participer_' ~ event.id) }}">
									<button type="submit" class="ehc-btn ehc-btn-primary" {% if isParticipating or isFull %} disabled {% endif %}>
										<i class="bi bi-check2-circle"></i>
										Participer
									</button>
								</form>

								{% if isParticipating %}
									<form method="post" action="{{ path('front_events_annuler', {id: event.id}) }}">
										<input type="hidden" name="_token" value="{{ csrf_token('front_annuler_' ~ event.id) }}">
										<button type="submit" class="ehc-btn ehc-btn-danger">
											<i class="bi bi-x-circle"></i>
											Annuler
										</button>
									</form>
								{% endif %}
							{% endif %}
						</div>


					</div>

					<div class="ev-actions">
						<a class="ev-action" href="{{ path('front_events_index') }}">
							<i class="bi bi-grid"></i>
							Voir tous les événements
						</a>
					</div>

				</div>

			</div>
		</main>
	</div>

	<script>
		window.addEventListener('scroll', () => {
document.querySelector('.topbar') ?. classList.toggle('is-scrolled', window.scrollY > 10);
});
	</script>
{% endblock %}
