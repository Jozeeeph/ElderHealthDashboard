{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('css/patient.css') }}?v=20260214-notif1">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<link rel="stylesheet" href="{{ asset('css/equipementFront.css') }}?v=2">
{% endblock %}

{% block body %}

	{% include 'FrontOffice/patient/_header.html.twig' %}


	<div
		class="products-page">
		<!-- Hero Section -->
		<section class="hero-section">
			<h1 class="hero-title">Équipements Médicaux</h1>
			<p class="hero-subtitle">Découvrez notre sélection d'équipements médicaux de qualité pour professionnels et particuliers</p>
			<div class="d-flex justify-content-end mb-3">
				<a href="{{ path('cart_view') }}" class="btn btn-outline-secondary position-relative">
					<i class="bi bi-cart"></i>
					Panier
					<span id="cart-count" class="badge bg-danger rounded-pill ms-2">{{ (app.session.get('cart')|default([]))|length }}</span>
				</a>
			</div>

			<!-- Search Bar -->
			<div class="search-container">
				<div class="search-box">
					<input type="text" placeholder="Rechercher un équipement..." class="search-input">
					<button class="search-button">
						<i class="bi bi-search"></i>
					</button>
				</div>
			</div>
		</section>

		<!-- Categories -->
		<section class="categories-section">
			<div class="categories-container">
				<a href="{{ path('front_equipements_index') }}" class="category-btn {% if current_category is not defined or current_category is null %}active{% endif %}">
					Tous les produits
				</a>
				{% set categories = [] %}
				{% for equipement in equipements %}
					{% if equipement.categorie and equipement.categorie not in categories %}
						{% set categories = categories|merge([equipement.categorie]) %}
						<a href="{{ path('front_equipements_by_category', {'categorie': equipement.categorie}) }}" class="category-btn {% if current_category is defined and current_category == equipement.categorie %}active{% endif %}">
							{{ equipement.categorie }}
						</a>
					{% endif %}
				{% endfor %}
			</div>
		</section>

		<!-- Products Grid -->
		<section class="products-section">
			<div class="products-header">
				<h2 class="section-title">
					{% if current_category is defined and current_category %}
						{{ current_category }}
					{% else %}
						Tous les équipements
					{% endif %}
					<span class="products-count">({{ equipements|length }}
						produits)</span>
				</h2>

				<div class="sort-container">
					<span class="sort-label">Trier par :</span>
					<select class="sort-select">
						<option>Meilleurs ventes</option>
						<option>Prix croissant</option>
						<option>Prix décroissant</option>
						<option>Nouveautés</option>
					</select>
				</div>
			</div>

			{% if equipements|length > 0 %}
				<div class="products-grid">
					{% for equipement in equipements %}
						<div
							class="product-card">
							<!-- Badge "Meilleurs ventes" pour certains produits -->
							{% if loop.index <= 3 %}
								<div class="product-badge">Meilleurs ventes</div>
							{% endif %}

							<!-- Image du produit -->
							<div style="position: relative; overflow: hidden; height: 240px;">
								{% if equipement.image %}
									<img src="{{ asset('uploads/images/' ~ equipement.image) }}" alt="{{ equipement.nom }}" class="product-image">
								{% else %}
									<div style="width: 100%; height: 100%; background: linear-gradient(135deg, #e8f6f9, #eef8f4); display: flex; align-items: center; justify-content: center;">
										<i class="bi bi-heart-pulse" style="font-size: 4rem; color: var(--primary-color); opacity: 0.5;"></i>
									</div>
								{% endif %}
							</div>

							<!-- Informations du produit -->
							<div class="product-info">
								<h3 class="product-title">{{ equipement.nom }}</h3>

								{% if equipement.description %}
									<p class="product-description">{{ equipement.description|slice(0, 120) }}...</p>
								{% endif %}

								<!-- Catégorie -->
								{% if equipement.categorie %}
									<div class="product-category-tag">
										{{ equipement.categorie }}
									</div>
								{% endif %}

								<!-- Prix -->
								<div class="product-price">{{ equipement.prix }}
									DT</div>

								<!-- Statut et quantité -->
								<div class="product-meta">
									<div>
										{% if equipement.statut == 'disponible' and equipement.quantiteDisponible > 5 %}
											<span class="status-badge status-available">✓ En stock</span>
										{% elseif equipement.statut == 'disponible' and equipement.quantiteDisponible <= 5 %}
											<span class="status-badge status-low">⚠ Stock limité</span>
										{% else %}
											<span class="status-badge status-out">✗ Rupture</span>
										{% endif %}
									</div>

									<div class="stock-info">
										{{ equipement.quantiteDisponible }}
										unités
									</div>
								</div>

								<!-- Actions -->
								<div class="product-actions">
									<a href="{{ path('front_equipements_show', {'id': equipement.id}) }}" class="btn-view">
										<i class="bi bi-eye"></i>
										Voir détails
									</a>
									<a href="{{ path('cart_add', {'id': equipement.id}) }}" class="btn-cart">
										<i class="bi bi-cart-plus"></i>
										Ajouter
									</a>
								</div>
							</div>
						</div>
					{% endfor %}
				</div>
			{% else %}
				<div class="empty-state">
					<div class="empty-icon">
						<i class="bi bi-clipboard-x"></i>
					</div>
					<h3 class="empty-title">Aucun équipement trouvé</h3>
					<p class="empty-text">Aucun équipement n'est disponible pour le moment dans cette catégorie.</p>
					<a href="{{ path('front_equipements_index') }}" class="empty-action">
						Voir tous les produits
					</a>
				</div>
			{% endif %}
		</section>
	</div>

	<!-- JavaScript -->
	 <script>
		    function addToCart(equipementId) {
		        fetch('/api/panier/ajouter/' + equipementId, {
		            method: 'POST',
		            headers: {
		                'Content-Type': 'application/json',
		                'X-CSRF-Token': '{{ csrf_token('add_to_cart') }}'
		            }
		        })
		        .then(response => response.json())
		        .then(data => {
		            if (data.success) {
		                showNotification('Produit ajouté au panier !', 'success');
		                updateCartCount(data.cartCount);
		            } else {
		                showNotification('Erreur lors de l\'ajout au panier', 'error');
		            }
		        })
		        .catch(error => {
		            console.error('Error:', error);
		            showNotification('Erreur de connexion', 'error');
		        });
		    }
		
		    function showNotification(message, type) {
		        const notification = document.createElement('div');
		        notification.style.cssText = `
		            position: fixed;
		            top: 20px;
		            right: 20px;
		            padding: 15px 20px;
		            background: ${type === 'success' ? '#4CAF50' : '#f44336'};
		            color: white;
		            border-radius: 10px;
		            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
		            z-index: 1000;
		            animation: slideIn 0.3s ease;
		        `;
		        notification.textContent = message;
		        
		        document.body.appendChild(notification);
		        
		        setTimeout(() => {
		            notification.style.animation = 'slideOut 0.3s ease';
		            setTimeout(() => notification.remove(), 300);
		        }, 3000);
		    }
		
		    function updateCartCount(count) {
		        const cartCount = document.getElementById('cart-count');
		        if (cartCount) {
		            cartCount.textContent = count;
		            cartCount.style.animation = 'bounce 0.3s';
		            setTimeout(() => cartCount.style.animation = '', 300);
		        }
		    }
		
		    // Animation CSS
		    const style = document.createElement('style');
		    style.textContent = `
		        @keyframes slideIn {
		            from { transform: translateX(100%); opacity: 0; }
		            to { transform: translateX(0); opacity: 1; }
		        }
		        @keyframes slideOut {
		            from { transform: translateX(0); opacity: 1; }
		            to { transform: translateX(100%); opacity: 0; }
		        }
		        @keyframes bounce {
		            0%, 100% { transform: scale(1); }
		            50% { transform: scale(1.2); }
		        }
		    `;
		    document.head.appendChild(style);
		</script>
{% endblock %}
